<!DOCTYPE html>
<html>
<head>

<title>Tile Entity - Minecraft Modding</title>

<meta charset="UTF-8">

<link rel="icon" href="http://mcmodding.ru/favicon_standart.png">

<meta name="description" content="Обычный блок не может уникальные данные. Если мы хотим что бы наш блок содержал уникальные данные для каждого отдельно взятого экземпляра нам нужно использовать TileEntity.">

<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Google Search Console -->
<meta name="google-site-verification" content="42BDFleqV-Ico-U62qM0MjOJOJTFq7rI1mRVWZmyb5s" />

<!-- Google Auto-Ads -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8094912170389944",
        enable_page_level_ads: true
    });
</script>

<!-- Google Material Icons -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<meta property="og:title"       content="Tile Entity - Minecraft Modding">
<meta property="og:description" content="Обычный блок не может уникальные данные. Если мы хотим что бы наш блок содержал уникальные данные для каждого отдельно взятого экземпляра нам нужно использовать TileEntity.">
<meta property="og:type"        content="article">
<meta property="og:url"         content="http://mcmodding.ru/book/1.12+/forge/tileentity/base">
<meta property="og:image"       content="http://mcmodding.ru/favicon_standart.png">
<!-- jQuery -->
<script src="http://mcmodding.ru/libs/jQuery/jquery-3.2.0.min.js"></script>

<!-- Hammer.js -->
<script src="http://mcmodding.ru/libs/hammer/hammer.min.js"></script>

<!-- Include scrollbar width in site width -->
<script src="http://mcmodding.ru/libs/mq.genie/mq.genie.min.js"></script>

<!-- highlight.js -->
<link href="http://mcmodding.ru/libs/highlight/styles/idea.css" rel="stylesheet">
<style>
    pre code.hljs {
        display: block;
    }

    code.hljs {
        display: inline;
    }
</style>
<script src="http://mcmodding.ru/libs/highlight/highlight.pack.js"></script>
<script>
    $(() => {
        $('pre code').each( (i, element) => {
            hljs.highlightBlock(element);
        });
    });
</script>

<!-- Magnific Popup -->
<link rel="stylesheet" href="http://mcmodding.ru/libs/magnific-popup/magnific-popup.min.css">
<script src="http://mcmodding.ru/libs/magnific-popup/magnific-popup.min.js"></script>
<script>
    $(() => {
        $('article .inner').magnificPopup({
            delegate: 'img',
            type: 'image',
            callbacks: {
                elementParse: (item) => { item.src = item.el.attr('src'); }
            }
        });
    });
</script>

<!-- Snap.svg -->
<script src="http://mcmodding.ru/libs/snap.svg/snap.svg-min.js"></script>
<!-- Global CSS -->
<link href="http://mcmodding.ru/g-styles/global.min.css" rel="stylesheet">

<!-- Book CSS -->
<link href="http://mcmodding.ru/book/styles/book.min.css" rel="stylesheet">

<!-- Book JS -->
<script>
    let book_id = '1.12+-forge';
</script>
<script src="http://mcmodding.ru/book/scripts/book.min.js"></script>
</head>
<body>

<header>
    <div class="inner">

        <div class="site-menu show-book-nav">
            <div title="Оглавление учебника" class="menu-item">
                <i class="material-icons">menu</i>
            </div>
        </div>

        <div id="logotype">
            <div class="cube">
                    <img src="http://mcmodding.ru/logotype/mc-modding/front.png" class="side front">
                    <img src="http://mcmodding.ru/logotype/mc-modding/back.png" class="side back">
                    <img src="http://mcmodding.ru/logotype/mc-modding/left.png" class="side left">
                    <img src="http://mcmodding.ru/logotype/mc-modding/right.png" class="side right">
                    <img src="http://mcmodding.ru/logotype/mc-modding/top.png" class="side top">
                    <img src="http://mcmodding.ru/logotype/mc-modding/bottom.png" class="side bottom">
            </div>
        </div>

        <div class="site-info">
            <div class="title">Minecraft Modding</div>
            <div class="description">Учебник по созданию Minecraft модов</div>
        </div>

        <div class="site-menu show-menu">
            <div class="menu-item">
                <i title="Меню сайта" class="material-icons">more_horiz</i>
            </div>
        </div>

        <div class="site-menu transformable">

            <a href="http://mcmodding.ru" title="Главная" class="menu-item">
                <i class="material-icons">home</i><span>Главная</span>
            </a>

            <a href="http://mcmodding.ru/book/1.12+/forge/prep/install" title="Учебник" class="menu-item">
                <i class="material-icons">import_contacts</i><span>Учебник</span>
            </a>

            <a href="https://forum.mcmodding.ru/forums/%D0%92%D0%BE%D0%BF%D1%80%D0%BE%D1%81%D1%8B.23/" target="_blank" title="Спросить" class="menu-item">
                <i class="material-icons">help_outline</i><span>Спросить</span>
            </a>

            <a href="https://forum.mcmodding.ru" target="_blank" title="Форум" class="menu-item">
                <i class="material-icons">forum</i><span>Форум</span>
            </a>

        </div>

    </div>
</header>
<nav>

    <div class="inner">

        <section class="book-choose">


                <div class="version-choose">
                    <label>Версия:
                        <select onChange="window.location.href=this.value">

                                <optgroup label="Релиз">
                                        <option value="http://mcmodding.ru/book/1.12+/forge/prep/install" selected>1.12+</option>
                                        <option value="http://mcmodding.ru/book/1.11+/forge/prep/install" >1.11+</option>
                                        <option value="http://mcmodding.ru/book/1.7.10/forge/base/first_steps" >1.7.10</option>
                                </optgroup>



                        </select>
                    </label>
                </div>


            <div class="api-choose">
                <label>API:
                    <select onChange="window.location.href=this.value">
                            <option value="http://mcmodding.ru/book/1.12+/forge/prep/install" selected>Forge</option>
                    </select>
                </label>
            </div>

        </section>

        <div class="categories">
                <div class="category">

                    <div class="category-header">
                        <a href="http://mcmodding.ru/book/1.12+/forge/prep/install" class="category-article ">Подготовка</a>

                        <svg xmlns="http://www.w3.org/2000/svg" title="Раскрыть/скрыть категорию" class="visibility-switcher switcher-0 closed" width="16" height="16" viewBox="0 0 512 512">
                            <rect class="horizontal-rect" x="0" y="192" width="512" height="128" rx="15" ry="15"/>
                            <rect class="vertical-rect"   x="192" y="0" width="128" height="512" rx="15" ry="15"/>
                        </svg>
                    </div>

                    <div class="category-articles">
                            <a href="http://mcmodding.ru/book/1.12+/forge/prep/install" class="article ">Установка программ</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/prep/setup_idea" class="article ">Использование Idea</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/prep/setup_eclipse" class="article ">Использование Eclipse</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/prep/off_skin" class="article ">Собственный скин</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/prep/problems" class="article ">Решение проблем</a>
                    </div>

                </div>
                <hr>
                <div class="category">

                    <div class="category-header">
                        <a href="http://mcmodding.ru/book/1.12+/forge/base/mod_structure" class="category-article ">Основы Forge</a>

                        <svg xmlns="http://www.w3.org/2000/svg" title="Раскрыть/скрыть категорию" class="visibility-switcher switcher-1 closed" width="16" height="16" viewBox="0 0 512 512">
                            <rect class="horizontal-rect" x="0" y="192" width="512" height="128" rx="15" ry="15"/>
                            <rect class="vertical-rect"   x="192" y="0" width="128" height="512" rx="15" ry="15"/>
                        </svg>
                    </div>

                    <div class="category-articles">
                            <a href="http://mcmodding.ru/book/1.12+/forge/base/mod_structure" class="article ">Структура мода</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/base/mod_annotation" class="article ">Аннотация @Mod</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/base/loading_stages" class="article ">Стадии загрузки мода</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/base/proxy" class="article ">Прокси</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/base/build_mod" class="article ">Сборка мода</a>
                    </div>

                </div>
                <hr>
                <div class="category">

                    <div class="category-header">
                        <a href="http://mcmodding.ru/book/1.12+/forge/item/base" class="category-article ">Предметы</a>

                        <svg xmlns="http://www.w3.org/2000/svg" title="Раскрыть/скрыть категорию" class="visibility-switcher switcher-2 closed" width="16" height="16" viewBox="0 0 512 512">
                            <rect class="horizontal-rect" x="0" y="192" width="512" height="128" rx="15" ry="15"/>
                            <rect class="vertical-rect"   x="192" y="0" width="128" height="512" rx="15" ry="15"/>
                        </svg>
                    </div>

                    <div class="category-articles">
                            <a href="http://mcmodding.ru/book/1.12+/forge/item/base" class="article ">Создание предмета</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/item/food" class="article ">Еда</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/item/tools" class="article ">Инструменты и меч</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/item/repair" class="article ">Починка инструментов</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/item/armor" class="article ">Броня</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/item/metadata" class="article ">Метадата</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/item/nbt" class="article ">Хранение в предмете</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/item/loot" class="article ">Система лута</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/item/rarity" class="article ">Редкость предметов</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/item/burn" class="article ">Предмет с временем горения</a>
                    </div>

                </div>
                <hr>
                <div class="category">

                    <div class="category-header">
                        <a href="http://mcmodding.ru/book/1.12+/forge/block/base" class="category-article ">Блоки</a>

                        <svg xmlns="http://www.w3.org/2000/svg" title="Раскрыть/скрыть категорию" class="visibility-switcher switcher-3 closed" width="16" height="16" viewBox="0 0 512 512">
                            <rect class="horizontal-rect" x="0" y="192" width="512" height="128" rx="15" ry="15"/>
                            <rect class="vertical-rect"   x="192" y="0" width="128" height="512" rx="15" ry="15"/>
                        </svg>
                    </div>

                    <div class="category-articles">
                    </div>

                </div>
                <hr>
                <div class="category">

                    <div class="category-header">
                        <a href="http://mcmodding.ru/book/1.12+/forge/tileentity/base" class="category-article selected">Tile Entity</a>

                        <svg xmlns="http://www.w3.org/2000/svg" title="Раскрыть/скрыть категорию" class="visibility-switcher switcher-4 closed" width="16" height="16" viewBox="0 0 512 512">
                            <rect class="horizontal-rect" x="0" y="192" width="512" height="128" rx="15" ry="15"/>
                            <rect class="vertical-rect"   x="192" y="0" width="128" height="512" rx="15" ry="15"/>
                        </svg>
                    </div>

                    <div class="category-articles">
                    </div>

                </div>
                <hr>
                <div class="category">

                    <div class="category-header">
                        <a href="http://mcmodding.ru/book/1.12+/forge/creativetab/base" class="category-article ">Вкладка в креативе</a>

                        <svg xmlns="http://www.w3.org/2000/svg" title="Раскрыть/скрыть категорию" class="visibility-switcher switcher-5 closed" width="16" height="16" viewBox="0 0 512 512">
                            <rect class="horizontal-rect" x="0" y="192" width="512" height="128" rx="15" ry="15"/>
                            <rect class="vertical-rect"   x="192" y="0" width="128" height="512" rx="15" ry="15"/>
                        </svg>
                    </div>

                    <div class="category-articles">
                    </div>

                </div>
                <hr>
                <div class="category">

                    <div class="category-header">
                        <a href="http://mcmodding.ru/book/1.12+/forge/lang/base" class="category-article ">Локализация</a>

                        <svg xmlns="http://www.w3.org/2000/svg" title="Раскрыть/скрыть категорию" class="visibility-switcher switcher-6 closed" width="16" height="16" viewBox="0 0 512 512">
                            <rect class="horizontal-rect" x="0" y="192" width="512" height="128" rx="15" ry="15"/>
                            <rect class="vertical-rect"   x="192" y="0" width="128" height="512" rx="15" ry="15"/>
                        </svg>
                    </div>

                    <div class="category-articles">
                    </div>

                </div>
                <hr>
                <div class="category">

                    <div class="category-header">
                        <a href="http://mcmodding.ru/book/1.12+/forge/events/base" class="category-article ">События</a>

                        <svg xmlns="http://www.w3.org/2000/svg" title="Раскрыть/скрыть категорию" class="visibility-switcher switcher-7 closed" width="16" height="16" viewBox="0 0 512 512">
                            <rect class="horizontal-rect" x="0" y="192" width="512" height="128" rx="15" ry="15"/>
                            <rect class="vertical-rect"   x="192" y="0" width="128" height="512" rx="15" ry="15"/>
                        </svg>
                    </div>

                    <div class="category-articles">
                            <a href="http://mcmodding.ru/book/1.12+/forge/events/base" class="article ">Использование событий</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/events/table" class="article ">Таблица событий</a>
                    </div>

                </div>
                <hr>
                <div class="category">

                    <div class="category-header">
                        <a href="http://mcmodding.ru/book/1.12+/forge/craftsmeltingandbrewing/craft" class="category-article ">Рецепты</a>

                        <svg xmlns="http://www.w3.org/2000/svg" title="Раскрыть/скрыть категорию" class="visibility-switcher switcher-8 closed" width="16" height="16" viewBox="0 0 512 512">
                            <rect class="horizontal-rect" x="0" y="192" width="512" height="128" rx="15" ry="15"/>
                            <rect class="vertical-rect"   x="192" y="0" width="128" height="512" rx="15" ry="15"/>
                        </svg>
                    </div>

                    <div class="category-articles">
                    </div>

                </div>
                <hr>
                <div class="category">

                    <div class="category-header">
                        <a href="http://mcmodding.ru/book/1.12+/forge/achievements/prep" class="category-article ">Достижения</a>

                        <svg xmlns="http://www.w3.org/2000/svg" title="Раскрыть/скрыть категорию" class="visibility-switcher switcher-9 closed" width="16" height="16" viewBox="0 0 512 512">
                            <rect class="horizontal-rect" x="0" y="192" width="512" height="128" rx="15" ry="15"/>
                            <rect class="vertical-rect"   x="192" y="0" width="128" height="512" rx="15" ry="15"/>
                        </svg>
                    </div>

                    <div class="category-articles">
                            <a href="http://mcmodding.ru/book/1.12+/forge/achievements/prep" class="article ">Начало</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/achievements/base" class="article ">Создание достижения</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/achievements/recipes" class="article ">Получение рецептов</a>
                    </div>

                </div>
                <hr>
                <div class="category">

                    <div class="category-header">
                        <a href="http://mcmodding.ru/book/1.12+/forge/plant/base" class="category-article ">Растения</a>

                        <svg xmlns="http://www.w3.org/2000/svg" title="Раскрыть/скрыть категорию" class="visibility-switcher switcher-10 closed" width="16" height="16" viewBox="0 0 512 512">
                            <rect class="horizontal-rect" x="0" y="192" width="512" height="128" rx="15" ry="15"/>
                            <rect class="vertical-rect"   x="192" y="0" width="128" height="512" rx="15" ry="15"/>
                        </svg>
                    </div>

                    <div class="category-articles">
                    </div>

                </div>
                <hr>
                <div class="category">

                    <div class="category-header">
                        <a href="http://mcmodding.ru/book/1.12+/forge/advanced/layers" class="category-article ">Продвинутые статьи</a>

                        <svg xmlns="http://www.w3.org/2000/svg" title="Раскрыть/скрыть категорию" class="visibility-switcher switcher-11 closed" width="16" height="16" viewBox="0 0 512 512">
                            <rect class="horizontal-rect" x="0" y="192" width="512" height="128" rx="15" ry="15"/>
                            <rect class="vertical-rect"   x="192" y="0" width="128" height="512" rx="15" ry="15"/>
                        </svg>
                    </div>

                    <div class="category-articles">
                            <a href="http://mcmodding.ru/book/1.12+/forge/advanced/layers" class="article ">Слои</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/advanced/keybinds" class="article ">Привязка клавиш</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/advanced/buffs" class="article ">Система временных эффектов</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/advanced/sounds" class="article ">Звуки</a>
                    </div>

                </div>
                <hr>
                <div class="category">

                    <div class="category-header">
                        <a href="http://mcmodding.ru/book/1.12+/forge/other/sources" class="category-article ">Дополнительно</a>

                        <svg xmlns="http://www.w3.org/2000/svg" title="Раскрыть/скрыть категорию" class="visibility-switcher switcher-12 closed" width="16" height="16" viewBox="0 0 512 512">
                            <rect class="horizontal-rect" x="0" y="192" width="512" height="128" rx="15" ry="15"/>
                            <rect class="vertical-rect"   x="192" y="0" width="128" height="512" rx="15" ry="15"/>
                        </svg>
                    </div>

                    <div class="category-articles">
                            <a href="http://mcmodding.ru/book/1.12+/forge/other/sources" class="article ">Исходники Minecraft</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/other/jei_integration" class="article ">Интеграция с Just Enough Items</a>
                            <a href="http://mcmodding.ru/book/1.12+/forge/other/access_transformers" class="article ">Access Transformers</a>
                    </div>

                </div>
                <hr>
        </div>

        <section class="ad-after-nav">

            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <!-- MCModding Book - Реклама под навигацией -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-8094912170389944"
                 data-ad-slot="5398483104"
                 data-ad-format="auto"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>

        </section>

    </div>

</nav><article>

    <div class="inner">

        <!-- Панель перевода страницы на другой язык -->
        <div id="google_translate_element"></div><script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({pageLanguage: 'ru', layout: google.translate.TranslateElement.FloatPosition.TOP_LEFT, multilanguagePage: true, gaTrack: true, gaId: 'UA-42024721-2'}, 'google_translate_element');
        }
        </script><script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>


        <a href="https://github.com/mc-modding/mc-modding-book/blob/master/book/1.12+/forge/tileentity/base/article.md" target="_blank" class="edit-article"><i class="material-icons">mode_edit</i><span>Редактировать</span></a>

        <h1 id="tile-entities">Tile Entities<a title="Ссылка на этот раздел" href="#tile-entities"><i class="material-icons">link</i></a></h1>
<p><em>Гайд перевел и дополнил пользователь форума — <a href="https://forum.mcmodding.ru/members/austeretony.7279/" target="_blank">AustereTony</a>.</em></p>
<p>В данной статье я предоставляю свой перевод гайда с сайта shadowfacts по работе с TileEntity. Исходники примера доступны <a href="https://github.com/AustereTony/Guides/tree/master/1.12.2/Tile%20Entities/Counter" target="_blank">тут</a>.</p>
<p>В Майнкрафте класс <code>Block</code> используется для представления не просто единичного блока в мире, а блока как типа. Инстанс (экземпляр) <code>Block</code> содержит свойства для каждого экземпляра вашего блока, существующего в мире. Если мы хотим что бы наш блок содержал уникальные данные для каждого отдельно взятого экземпляра нам нужно использовать <code>TileEntity</code>.</p>
<p>Существует распространённый миф что <code>TileEntity</code> это плохо, особенно для производительности. Это не так. Они могут негативно влиять на производительность если они реализованы не умело, как в прочем и любые другие объекты.</p>
<p>Тайлы бывают двух типов: обновляющиеся (<em>ticking</em>) и не обновляющиеся (<em>non-ticking</em>). Обновляющиеся тайлы обновляются каждый игровой тик (обычно 20 раз в секунду). Они влияют на производительность интенсивнее и требуют аккуратной реализации. Не обновляющиеся тайлы существуют для простого хранения данных и в этом туториале мы создадим простой, не обновляющийся <code>TileEntity</code>.</p>
<h2 id="вспомогательные-средства">Вспомогательные средства<a title="Ссылка на этот раздел" href="#вспомогательные-средства"><i class="material-icons">link</i></a></h2>
<p>Прежде чем мы создадим тайл, мы добавим класс, который упростит их создание в будущем.</p>
<p>В первую очередь создадим класс <code>BlockTileEntity</code>:</p>
<pre><code class="java language-java">// ru.austeretony.counter.block.tile.BlockTileEntity.java

public abstract class BlockTileEntity&lt;T extends TileEntity&gt; extends BaseBlock {

    public BlockTileEntity(String name, Material material, float hardness, float resistanse, SoundType soundType) {

        super(name, material, hardness, resistanse, soundType);
    }

    public abstract Class&lt;T&gt; getTileEntityClass();

    public T getTileEntity(IBlockAccess world, BlockPos position) {

        return (T) world.getTileEntity(position);
    }

    @Override
    public boolean hasTileEntity(IBlockState blockState) {

        return true;
    }

    @Nullable
    @Override
    public abstract T createTileEntity(World world, IBlockState blockState);
}
</code></pre>
<p>Этот класс предоставляет нам следующее:</p>
<ul>
<li>Он расширяет <code>BaseBlock</code>, содержащий нашу удобную базовую реализацию <code>Block</code></li>
</ul>
<pre><code class="java language-java">// ru.austeretony.counter.block.base.BaseBlock.java

public class BaseBlock extends Block {

    public BaseBlock(String name, Material material, float hardness, float resistanse, SoundType soundType) {

        super(material);

        this.setRegistryName(name);
        this.setUnlocalizedName(name);
        this.setHardness(hardness);
        this.setResistance(resistanse);
        this.setSoundType(soundType);
    }
}
</code></pre>
<ul>
<li>Он содержит обобщение, представляющее наш класс <code>TileEntity</code>. Он будет использован для создания вспомогательных средств для уменьшения количества необходимых приведений типов для получения экземпляра нашего тайла на определённой позиции и для уверенности в том, что созданный тайл имеет корректный тип.</li>
<li>Он переопределяет <code>hasTileEntity(IBlockState)</code> из <code>Block</code> и возвращает <code>true</code>. Это даёт понять Майнкрафту что у нашего блока есть тайл и его нужно создать.</li>
<li>Он содежит два абстрактных метода: 1) <code>getTileEntityClass()</code> - тут мы будем возвращать класс нашего <code>TileEntity</code>, что позволит ему быть зарегистрированным вместе с блоком, 2) <code>createTileEntity()</code> - более специфичная версия стандартного метода из <code>Block</code>. Майнкрафт вызывает его каждый раз когда нужно создать новый экземпляр тайла, например когда мы устанавливаем наш блок.</li>
</ul>
<h2 id="блок">Блок<a title="Ссылка на этот раздел" href="#блок"><i class="material-icons">link</i></a></h2>
<p>Теперь когда у нас есть удобная основа самое время создать блок.</p>
<p>Создадим <code>BlockCounter</code>, расширяющий <code>BlockTileEntity</code>.</p>
<pre><code class="java language-java">// ru.austeretony.counter.block.BlockCounter.java

public class BlockCounter extends BlockTileEntity&lt;TileEntityCounter&gt; {

    public BlockCounter(String name, Material material, float hardness, float resistanse, SoundType soundType) {

        super(name, material, hardness, resistanse, soundType);

        this.setHarvestLevel("pickaxe", 3);
    }

    @Override
    public boolean onBlockActivated(World world, BlockPos position, IBlockState blockState, EntityPlayer player, EnumHand hand, EnumFacing side, float hitX, float hitY, float hitZ) {

        if (!world.isRemote) {

            TileEntityCounter tileEntity = getTileEntity(world, position);

            if (side == EnumFacing.DOWN) {

                tileEntity.decrementCount();

            }

            else if (side == EnumFacing.UP) {

                tileEntity.incrementCount();
            }

            player.sendMessage(new TextComponentString("Count: " + tileEntity.getCount()));
        }

        return true;
    }

    @Override
    public Class&lt;TileEntityCounter&gt; getTileEntityClass() {

        return TileEntityCounter.class;
    }

    @Override
    public TileEntityCounter createTileEntity(World world, IBlockState blockState) {

        return new TileEntityCounter();
    }
}
</code></pre>
<p>Наш блок расширяет <code>BlockTileEntity</code> и содержит обобщение <code>TileEntityCounter</code> (который предстоит создать), так как этот тайл принадлежит этому блоку.</p>
<p>В конструкторе мы просто напросто вызываем суперконструктор и передаём туда все параметры, которые будем указывать при создании блока.</p>
<p>В методе <code>getTileEntityClass()</code> вернём <code>TileEntityCounter.class</code> (мы ещё создадим его).
Это позволит зарегистрировать его ассоциировав с именем блока.</p>
<p>В <code>createTileEntity()</code> мы возвращаем новый экземпляр класса <code>TileEntityCounter</code>.</p>
<p>Ну и в конце концов в <code>onBlockActivated()</code>, вызываемый при правом клике по блоку мы делаем следующее:</p>
<ul>
<li>Проверяем, что действия производятся на сервере (это очень важно при работе с <code>TileEntity</code>!).</li>
<li>Достаём экземпляр <code>TileEntityCounter</code>.</li>
<li>Если игрок кликнул по нижней стороне - уменьшаем значение счётчика.</li>
<li>Если клик по верхней стороне - увеличиваем значение.</li>
<li>Отправляем сообщение в чат, содержащие значение счётчика.</li>
<li>Возвращаем <code>true</code>.</li>
</ul>
<h2 id="разделение-клиент-и-сервер">Разделение: клиент и сервер<a title="Ссылка на этот раздел" href="#разделение-клиент-и-сервер"><i class="material-icons">link</i></a></h2>
<p>Как было подмечено выше, перед тем как работать со счётчиком тайла, мы должны удостовериться, что действия происходят на сервере. Делаем мы это потому как в Майнкрафте клиент и сервер полностью разделены и некоторые методы вызываются для обеих сторон.</p>
<p>В многопользовательской игре множество клиентов подключены к одному серверу. В этом случае разделение между сторонами очевидно, но в одиночной игре всё немного сложнее. В многопользовательской игре сервер, к которому происходит подключение, отражает <em>физический сервер</em> и все отдельные подключенные клиенты являются <em>физическими клиентами</em>.</p>
<p>В одиночной игре клиент и сервер тоже разделены даже несмотря на то, что они исполняются на одном компьютере (на одной JVM, но в разных потоках). В одиночной игре клиент подключается к локальному, приватному серверу, функции которого схожи с физическим сервером. В этом случае серверный поток отражает <em>логический сервер</em>, а клиентский поток отражает <em>логический клиент</em>, так как обе логические стороны выполняются на одной физической стороне.</p>
<p>Поле <code>World.isRemote</code> используется для проверки стороны, на которой происходит выполнение (будь она логической или физической). Оно равно <code>true</code> для <em>физического клиента</em> в многопользовательской игре и для <em>логического клиента</em> в одиночной игре. Это поле равно <code>false</code> для <em>физического сервера</em> в многопользовательской игре и для <em>логического сервера</em> в одиночной.</p>
<p>Делая проверку в условии <code>!world.isRemote</code>, мы обеспечиваем уверенность что действия будут производится на сервере (физическом или логическом).</p>
<h2 id="создание-тайла-для-блока">Создание тайла для блока<a title="Ссылка на этот раздел" href="#создание-тайла-для-блока"><i class="material-icons">link</i></a></h2>
<p>Теперь когда у нас есть блок, мы должны создать тайл для него.</p>
<p>Создадим класс <code>TileEntityCounter</code>:</p>
<pre><code class="java language-java">// ru.austeretony.counter.block.tile.TileEntityCounter.java

public class TileEntityCounter extends TileEntity {

    private int count;

    @Override
    public NBTTagCompound writeToNBT(NBTTagCompound tagCompound) {

        tagCompound.setInteger("count", this.count);

        return super.writeToNBT(tagCompound);
    }

    @Override
    public void readFromNBT(NBTTagCompound tagCompound) {

        this.count = tagCompound.getInteger("count");

        super.readFromNBT(tagCompound);
    }

    public int getCount() {

        return this.count;
    }

    public void incrementCount() {

        this.count++;

        this.markDirty();
    }

    public void decrementCount() {

        this.count--;

        this.markDirty();
    }
}
</code></pre>
<p>Содержимое весьма не хитрое:</p>
<ul>
<li>Класс расширяет стандартный <code>TileEntity</code></li>
<li>Содержит приватное поле <code>count</code>, содержащее значение счётчика.</li>
<li>Переопределяет <code>writeToNBT()</code> и <code>readFromNBT()</code> что бы наши данные были сохранены и загружены с диска.</li>
<li>Предоставляет методы <code>getCount()</code>, <code>incrementCount()</code>, <code>decrementCount()</code> для работы с полем <code>count</code>.
Кроме того, в методах, изменяющих значение счётчика (<code>count</code>) происходит вызов <code>markDirty()</code> из <code>TileEntity</code>. Он даёт игре понять что данные были изменены с момента последнего сохранения и их нужно перезаписать.</li>
</ul>
<h2 id="nbt-формат">NBT формат<a title="Ссылка на этот раздел" href="#nbt-формат"><i class="material-icons">link</i></a></h2>
<p>Данный формат используется для хранения данных в виде пар ключ-значение, которые легко сериализуется в байты и сохраняется на диск. Вы можете ознакомиться с классом NBTTagCompound для представления о типах данных, которые он может хранить. Ванильный код содержит множество хороших примеров по сохранению и чтению сложных структур данных.</p>
<p>В нашем случае мы сохраняем значение поля count как целочисленный тип <code>Integer</code> с ключём в виде строки "<code>count</code>" в NBT в методе <code>writeToNBT()</code> и читаем его в <code>readFromNBT()</code>.</p>
<h2 id="регистрация">Регистрация<a title="Ссылка на этот раздел" href="#регистрация"><i class="material-icons">link</i></a></h2>
<p>Тайл нашего блока нужно зарегистрировать. Делать мы это будем там же, где регистрируем наши блоки.</p>
<p>Регистрацию будем производить через вызов <code>GameRegistry.registerTileEntity()</code>
и передавать в него класс тайла и его регистрационное имя. Это требуется для того, что бы при загрузке Майнкрафт определял какой <code>TileEntity</code> к какому блоку принадлежит и пересоздавал его загружая из NBT.</p>
<pre><code class="java language-java">// ru.austeretony.counter.main.BlockRegistry.java

public class BlockRegistry {

    public static final Block
    BLOCK_COUNTER = new BlockCounter("block_counter", Material.ROCK, 10.0F, 10.0F, SoundType.STONE).setCreativeTab(CreativeTabs.BUILDING_BLOCKS);

    public static void register() {

        setBlockRegister(BLOCK_COUNTER);
        setItemBlockRegister(BLOCK_COUNTER);
        GameRegistry.registerTileEntity(((BlockCounter) BLOCK_COUNTER).getTileEntityClass(), BLOCK_COUNTER.getRegistryName().toString());
    }

    @SideOnly(Side.CLIENT)
    public static void registerRender() {

        setItemBlockRender(BLOCK_COUNTER);
    }

    private static void setBlockRegister(Block block) {

        ForgeRegistries.BLOCKS.register(block);
    }

    private static void setItemBlockRegister(Block block) {

        ForgeRegistries.ITEMS.register(new ItemBlock(block).setRegistryName(block.getRegistryName()));
    }

    @SideOnly(Side.CLIENT)
    private static void setItemBlockRender(Block block) {

        ModelLoader.setCustomModelResourceLocation(Item.getItemFromBlock(block), 0, new ModelResourceLocation(block.getRegistryName(), "inventory"));
    }
}
</code></pre>
<p>Не забывайте, регистрация <code>Block</code>, <code>ItemBlock</code> и <code>TileEntity</code> происходит во время преинициализации в <code>CommonProxy</code>, а регистрация рендера для <code>ItemBlock</code> происходит в процессе преинициализации в <code>ClientProxy</code> (для рендера через <code>ModelLoader</code>).</p>
<h2 id="финал">Финал<a title="Ссылка на этот раздел" href="#финал"><i class="material-icons">link</i></a></h2>
<p>Теперь, когда все сделано, запускаем игру и достаем наш блок-счётчик из вкладки "блоки".
Установив его, кликните ПКМ по верхней стороне блока - счётчик увеличит значение и в чате появится сообщение.</p>
<p><img src="images/incremented.png" alt="Увеличение значения счетчика" /></p>
<p>Нажав ПКМ по нижней стороне несколько раз вы увидите это:</p>
<p><img src="images/decremented.png" alt="Уменьшение значения счетчика" /></p>
<p>Клик ПКМ по другим сторонам выведет в чат сообщение с текущим значением счётчика.</p>

    </div>

    <section class="next-previous-articles">

        <a class="previous-article" title="Переход на предыдущую статью" href="http:&#x2F;&#x2F;mcmodding.ru&#x2F;book&#x2F;1.12+&#x2F;forge&#x2F;block&#x2F;base">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" heigth="32" viewBox="0 0 512 512" class="previous-icon">
                <path d="M16 256l240 240v-144h256v-192h-256v-144z"></path>
            </svg>
            <span class="label">Предыдущая статья</span>
        </a>

        <div class="sep"></div>

        <a class="next-article" title="Переход на следующую статью" href="http:&#x2F;&#x2F;mcmodding.ru&#x2F;book&#x2F;1.12+&#x2F;forge&#x2F;creativetab&#x2F;base">
            <span class="label">Следующая статья</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="32" heigth="32" viewBox="0 0 512 512" class="next-icon">
                <path d="M496 256l-240-240v144h-256v192h256v144z"></path>
            </svg>
        </a>

    </section>

    <section class="contributors">


            <a href="https://github.com/CMTV" target="_blank" title="К профилю GitHub" class="contributor">

                <img class="avatar" src="https://github.com/CMTV.png?size=40">

                <div class="info">

                    <div class="name">CMTV</div>

                    <div class="role">Перенес с форума</div>

                </div>

            </a>


    </section>

    <section class="ad-after-article">

        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <!-- McModding Book Под статьей -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-8094912170389944"
             data-ad-slot="4828749197"
             data-ad-format="auto"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>

    </section>

    <section class="disqus">

        <div id="disqus_thread"></div>
        <script>

            var disqus_config = function () {
                this.page.identifier = 'http://mcmodding.ru/book/1.12+/forge/tileentity/base';
            };

            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');
                s.src = 'https://mcmodding.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </section>

    <div class="site-info">

        <a href="https://github.com/mc-modding/mc-modding-book/commits/master" target="_blank" class="copyright">mcmodding.ru</a>

        <a class="version-link" title="Последние изменения" href="https://github.com/mc-modding/mc-modding-book/commits/master" target="_blank">v1.1.1</a>

    </div>

</article>
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter21621697 = new Ya.Metrika({
                    id:21621697,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true,
                    webvisor:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/21621697" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google Analytics -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-42024721-1', 'auto');
    ga('send', 'pageview');

</script>
<!-- /Google Analytics -->
</body>
</html>